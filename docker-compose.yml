version: '3'
services:
  derper:
    image: 'troymitchell/derper'
    container_name: 'derper'
    restart: always
    environment:
      - DERP_DOMAIN=domain.com
      # My cert is generated by acme
      # Whatever tools you use,They must be .crt and .key.
      - DERP_CERT_MODE=manual
      - DERP_ADDR=:34567
      # I don't use HTTP port
      - DERP_HTTP_PORT=-1
      # I need to verify clients
      - DERP_VERIFY_CLIENTS=true
    ports:
      - '34567:34567'
      # udp port
      - '3478:3478'
    volumes:
      # I need to verify clients
      - /var/run/tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock 
      # certs
      - /home/troy/docker/derper/certs:/app/certs

